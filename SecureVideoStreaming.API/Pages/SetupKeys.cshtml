@page
@model SecureVideoStreaming.API.Pages.SetupKeysModel
@{
    ViewData["Title"] = "Configuración de Claves";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body p-5 text-center">
                    <div id="generatingSection">
                        <div class="mb-4">
                            <i class="bi bi-shield-lock text-primary" style="font-size: 4rem;"></i>
                        </div>
                        <h3 class="mb-3">Configuración de Seguridad</h3>
                        <p class="text-muted mb-4">
                            Para poder acceder a videos cifrados, necesitas generar un par de claves criptográficas.
                            Este proceso solo ocurre una vez.
                        </p>
                        
                        <div class="alert alert-info text-start">
                            <i class="bi bi-info-circle"></i>
                            <strong>¿Qué son las claves RSA?</strong><br>
                            Se generarán dos claves: una <strong>pública</strong> (para que los administradores te envíen videos cifrados)
                            y una <strong>privada</strong> (para que puedas descifrarlos).
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button type="button" class="btn btn-primary btn-lg" id="generateKeysBtn">
                                <i class="bi bi-key"></i> Generar Mis Claves
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="importKeysBtn">
                                <i class="bi bi-upload"></i> Ya tengo mis claves (Importar)
                            </button>
                        </div>
                    </div>

                    <div id="progressSection" style="display:none;">
                        <div class="mb-4">
                            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                                <span class="visually-hidden">Generando...</span>
                            </div>
                        </div>
                        <h4 id="progressText">Generando claves RSA-2048...</h4>
                        <p class="text-muted">Este proceso puede tardar unos segundos</p>
                    </div>

                    <div id="successSection" style="display:none;">
                        <div class="mb-4">
                            <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                        </div>
                        <h3 class="mb-3 text-success">¡Claves Generadas Exitosamente!</h3>
                        <p class="text-muted">Tu clave privada se ha guardado de forma cifrada en tu navegador.</p>
                        
                        <div class="alert alert-warning text-start mt-3">
                            <i class="bi bi-exclamation-triangle"></i>
                            <strong>Importante:</strong> Se recomienda descargar un respaldo de tu clave privada.
                            Sin esta clave, no podrás acceder a los videos cifrados.
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button type="button" class="btn btn-warning" id="downloadBackupBtn">
                                <i class="bi bi-download"></i> Descargar Respaldo
                            </button>
                            <button type="button" class="btn btn-success" id="continueBtn">
                                Continuar sin Descargar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Importación -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-upload"></i> Importar Clave Privada
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Selecciona el archivo JSON que contiene tu clave privada:</p>
                <input type="file" class="form-control" id="keyFileInput" accept=".json">
                <div class="mt-3 alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    Este archivo fue descargado cuando generaste tus claves por primera vez.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="importConfirmBtn">Importar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/rsa-crypto.js"></script>
    <script src="~/js/key-storage.js"></script>
    <script src="~/js/setup-keys.js"></script>
}
